<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="../favicon.png">
    <title>Checkout - Kusda Gym</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root { --primary-teal: #00bfa6; --bg-yellow: #fbc02d; --dark-text: #212529; font-family: 'Poppins', sans-serif; }
        body { font-family: var(--font-family); background-color: #f8f9fa; padding-top: 80px; }

        .checkout-card { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        .card-header-custom { background: var(--bg-yellow); padding: 20px; text-align: center; }
        .summary-box { background: #f0fdfb; border: 1px dashed var(--primary-teal); border-radius: 10px; padding: 15px; margin-bottom: 20px; }
        .payment-option { border: 2px solid #eee; border-radius: 10px; padding: 15px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; margin-bottom: 10px; }
        .payment-option:hover, .payment-option.active { border-color: var(--primary-teal); background: #e0f2f1; }
        .payment-option i { font-size: 1.5rem; margin-right: 15px; color: var(--primary-teal); }
    </style>
</head>
<body>

    <script src="../../components.js"></script> <script src="../components.js"></script> 
    <script> renderNavbar('../'); </script>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="checkout-card">
                    <div class="card-header-custom">
                        <h2 class="h4 mb-0 fw-bold">FORMULIR PEMBAYARAN</h2>
                    </div>
                    <div class="p-4">
                        
                        <div class="summary-box text-center">
                            <h5 class="text-muted small">PAKET YANG DIPILIH</h5>
                            <h3 class="fw-bold" style="color:var(--primary-teal)" id="planName">Loading...</h3>
                            <h2 class="display-6 fw-bold" id="planPrice">Rp0</h2>
                        </div>

                        <form id="paymentForm">
                            <h5 class="mb-3 fw-bold">Data Diri</h5>
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label class="form-label small text-muted">Nama Lengkap</label>
                                    <input type="text" class="form-control" id="userName" readonly style="background:#f9f9f9">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small text-muted">Email</label>
                                    <input type="email" class="form-control" id="userEmail" readonly style="background:#f9f9f9">
                                </div>
                                <div class="col-12">
                                    <label class="form-label small fw-bold">Nomor WhatsApp (Aktif)</label>
                                    <input type="tel" class="form-control" placeholder="08xxxxxxxxxx" required>
                                </div>
                            </div>

                            <h5 class="mb-3 fw-bold">Metode Pembayaran</h5>
                            <div class="mb-4">
                                <div class="payment-option" onclick="selectPay(this)">
                                    <i class="fas fa-university"></i>
                                    <div><strong>Transfer Bank BCA</strong><br><small class="text-muted">Otomatis cek</small></div>
                                </div>
                                <div class="payment-option" onclick="selectPay(this)">
                                    <i class="fas fa-wallet"></i>
                                    <div><strong>GoPay / OVO / Dana</strong><br><small class="text-muted">Scan QRIS</small></div>
                                </div>
                                <div class="payment-option" onclick="selectPay(this)">
                                    <i class="fas fa-store"></i>
                                    <div><strong>Indomaret / Alfamart</strong><br><small class="text-muted">Bayar di kasir</small></div>
                                </div>
                            </div>

                            <button type="submit" class="btn-custom btn-lg shadow">BAYAR SEKARANG</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const planName = params.get('plan') || 'Paket Member';
        const planPrice = params.get('price') || '0';

        const formatRupiah = (num) => "Rp" + parseInt(num).toLocaleString('id-ID');

        document.getElementById('planName').innerText = planName;
        document.getElementById('planPrice').innerText = formatRupiah(planPrice);

        // --- AMBIL DATA USER UNTUK AUTOFILL ---
        const activeUser = localStorage.getItem("loggedUser");
        const users = JSON.parse(localStorage.getItem("users")) || [];
        const userData = users.find(u => u.name === activeUser);

        if (!activeUser || !userData) {
            alert("Sesi habis! Silakan login ulang.");
            window.location.href = "../index.html";
        } else {
            document.getElementById('userName').value = userData.name;
            document.getElementById('userEmail').value = userData.email;
        }

        function selectPay(el) {
            document.querySelectorAll('.payment-option').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
        }

        document.getElementById('paymentForm').onsubmit = function(e) {
            e.preventDefault();
            
            // Update status member
            userData.isMember = true;
            localStorage.setItem("users", JSON.stringify(users));

            Swal.fire({
                icon: 'success',
                title: 'Pembayaran Berhasil!',
                text: 'Selamat! Akun Anda kini Premium Member.',
                confirmButtonColor: '#00bfa6'
            }).then(() => {
                window.location.href = "../index.html";
            });
        }
    </script>
</body>
</html>