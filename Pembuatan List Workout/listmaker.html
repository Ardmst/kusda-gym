<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="../favicon.png">
    <title>Workout Generator - Kusda Gym</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root { --primary-teal: #00bfa6; --light-bg: #f8f9fa; --dark-text: #212529; --font-family: 'Poppins', sans-serif; }
        body { font-family: var(--font-family); padding-top: 80px; background-color: #f4f4f4; min-height: 100vh; }

        .main-card { background: white; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.1); overflow: hidden; margin-top: 30px; }
        
        .page-header-title { color: var(--primary-teal); font-weight: 800; text-transform: uppercase; letter-spacing: 2px; }
        .exercise-sidebar { height: 600px; overflow-y: auto; border-right: 1px solid #dee2e6; background-color: #fcfcfc; padding: 15px; }
        .exercise-item { display: flex; align-items: center; background: white; border: 1px solid #eee; border-radius: 12px; padding: 10px; margin-bottom: 12px; cursor: pointer; transition: 0.2s; }
        .exercise-item:hover, .exercise-item.active { border-color: var(--primary-teal); transform: translateX(5px); background-color: #e0f2f1; }
        .exercise-thumb { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; margin-right: 15px; }
        .week-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; padding: 10px; background: #f8f9fa; border-top: 1px solid #dee2e6; }
        @media (max-width: 992px) { .week-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); } }
        .day-column { background: white; border-radius: 8px; border: 1px solid #e9ecef; display: flex; flex-direction: column; overflow: hidden; }
        .day-header { background: #212529; color: white; text-align: center; padding: 8px 5px; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; }
        .workout-list { padding: 5px; font-size: 0.75rem; height: 250px; overflow-y: auto; background-color: #fff; }
        .workout-chip { background: #fff; border-left: 3px solid var(--primary-teal); padding: 6px; margin-bottom: 6px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; }
        .option-card { border: 2px solid #eee; border-radius: 12px; padding: 20px; cursor: pointer; transition: 0.2s; text-align: center; height: 100%; }
        .option-card:hover { border-color: var(--primary-teal); background: #e0f2f1; }
        .option-input:checked + .option-card { background-color: var(--primary-teal); color: white; border-color: var(--primary-teal); box-shadow: 0 5px 15px rgba(0, 191, 166, 0.3); }
        .option-input { display: none; }
        .btn-sky { background-color: var(--primary-teal); color: white; border: none; font-weight: 600; }
        .btn-sky:hover { background-color: #008f7a; color: white; }
    </style>
</head>
<body>

    <script src="../../components.js"></script> <script src="../components.js"></script> 
    <script> renderNavbar('../'); </script>
    
    <script>
        (function() {
        const activeUser = localStorage.getItem("loggedUser");
        const users = JSON.parse(localStorage.getItem("users")) || [];
        const userData = users.find(u => u.name === activeUser);

        // Jika belum login ATAU bukan member
        if (!activeUser || !userData || !userData.isMember) {
            alert("ðŸ”’ AKSES DITOLAK!\nHalaman ini khusus Member Premium.\nSilakan Login atau Beli Paket Membership.");
            // Redirect paksa ke halaman membership di index
            window.location.href = "../index.html#membership"; 
        }
    })();
        document.addEventListener("DOMContentLoaded", function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const statusPremium = localStorage.getItem('isPremium');
            let redirect = false;
            let title = '';
            let text = '';

            // ðŸ”¥ KOREKSI: Cek 1: HARUS LOGIN dulu
            if (isLoggedIn !== 'true') {
                redirect = true;
                title = 'Akses Dibatasi';
                text = 'Anda harus login untuk mengakses fitur ini.';
            } 
            // ðŸ”¥ KOREKSI: Cek 2: HARUS PREMIUM (Jika sudah login)
            else if (statusPremium !== 'true') {
                redirect = true;
                title = 'Akses Ditolak';
                text = 'Fitur Workout Generator KHUSUS MEMBER PREMIUM!';
            }

            if (redirect) {
                Swal.fire({
                    icon: 'error',
                    title: title,
                    text: text,
                    confirmButtonText: (isLoggedIn !== 'true' ? 'Login Sekarang' : 'OK'),
                    confirmButtonColor: '#00bfa6',
                    allowOutsideClick: false,
                    allowEscapeKey: false
                }).then(() => {
                    if (isLoggedIn !== 'true') {
                        // Redirect ke halaman login
                        window.location.href = "../Login-Register/loginregister.html";
                    } else {
                        // Redirect ke halaman membership di index.html
                        window.location.href = "../index.html#membership"; 
                    }
                });
            }
        });
    </script>


    <div class="container py-4">
        <div class="main-card">
            <div class="p-4 border-bottom text-center bg-white">
                <h1 class="page-header-title h2">PERENCANA LATIHAN</h1>
                <p class="text-muted mb-0 small">Atur jadwal manual atau biarkan kami buatkan untuk Anda.</p>
            </div>
            <ul class="nav nav-tabs nav-fill" id="planTabs" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual-content" type="button" style="color:var(--primary-teal); font-weight:600;"><i class="fas fa-edit me-2"></i>Workspace Latihan (Manual)</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="auto-tab" data-bs-toggle="tab" data-bs-target="#auto-content" type="button" style="color:var(--primary-teal); font-weight:600;"><i class="fas fa-robot me-2"></i>Generator Otomatis</button>
                </li>
            </ul>
            <div class="card-body p-0">
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="manual-content">
                        <div class="row g-0">
                            <div class="col-md-4 exercise-sidebar">
                                <input type="text" class="form-control mb-3" placeholder="Cari latihan..." id="searchExercise">
                                <div id="exerciseList"></div>
                            </div>
                            <div class="col-md-8 p-4 bg-white" style="height: 600px; overflow-y: auto;">
                                <h5 class="border-start border-4 ps-3 mb-4" style="border-color: var(--primary-teal) !important;">Edit Detail</h5>
                                <div id="emptyState" class="text-center py-5 text-muted"><i class="fas fa-mouse-pointer fa-2x mb-3"></i><p>Klik latihan di kiri untuk menambahkan ke jadwal.</p></div>
                                <div id="configForm" style="display:none;">
                                    <div class="d-flex align-items-center mb-4 p-3 bg-light rounded">
                                        <img src="" id="previewImg" class="rounded me-3" width="80" height="80" style="object-fit:cover;">
                                        <div><h4 id="previewName" class="mb-0 fw-bold">Name</h4><span id="previewMuscle" class="badge bg-secondary">Muscle</span></div>
                                    </div>
                                    <div class="row g-3 mb-4">
                                        <div class="col-6"><label class="small fw-bold">Sets</label><input type="number" id="inputSets" class="form-control" value="3"></div>
                                        <div class="col-6"><label class="small fw-bold">Reps</label><input type="number" id="inputReps" class="form-control" value="12"></div>
                                        <div class="col-12"><label class="small fw-bold">Hari</label>
                                            <select id="inputDay" class="form-select">
                                                <option value="senin">Senin</option><option value="selasa">Selasa</option><option value="rabu">Rabu</option><option value="kamis">Kamis</option><option value="jumat">Jumat</option><option value="sabtu">Sabtu</option><option value="minggu">Minggu</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="d-grid gap-2"><button onclick="addToManualSchedule()" class="btn btn-sky">Tambahkan ke Jadwal</button></div>
                                </div>
                            </div>
                        </div>
                        <div class="week-grid" id="main-grid">
                            <div class="day-column"><div class="day-header">SENIN</div><div class="workout-list" id="day-senin"></div></div>
                            <div class="day-column"><div class="day-header">SELASA</div><div class="workout-list" id="day-selasa"></div></div>
                            <div class="day-column"><div class="day-header">RABU</div><div class="workout-list" id="day-rabu"></div></div>
                            <div class="day-column"><div class="day-header">KAMIS</div><div class="workout-list" id="day-kamis"></div></div>
                            <div class="day-column"><div class="day-header">JUMAT</div><div class="workout-list" id="day-jumat"></div></div>
                            <div class="day-column"><div class="day-header">SABTU</div><div class="workout-list" id="day-sabtu"></div></div>
                            <div class="day-column"><div class="day-header">MINGGU</div><div class="workout-list" id="day-minggu"></div></div>
                        </div>
                        <div class="p-3 bg-light text-end border-top">
                             <button onclick="clearSchedule()" class="btn btn-outline-danger rounded-pill px-4 fw-bold me-2"><i class="fas fa-trash me-2"></i>RESET</button>
                             <button onclick="saveSchedule()" class="btn btn-success rounded-pill px-4 fw-bold"><i class="fas fa-save me-2"></i>SIMPAN</button>
                        </div>
                    </div>

                    <div class="tab-pane fade p-5" id="auto-content">
                        <div class="text-center" style="max-width: 800px; margin: 0 auto;">
                            <h4 class="mb-4 fw-bold text-dark">Generator Jadwal Pintar</h4>
                            <h6 class="text-start text-muted mb-3"><i class="fas fa-layer-group me-2"></i>Pengalaman</h6>
                            <div class="row g-3 mb-4">
                                <div class="col-md-6"><label class="w-100"><input type="radio" name="level" value="beginner" class="option-input" checked><div class="option-card"><h5>Pemula</h5><small>Baru mulai</small></div></label></div>
                                <div class="col-md-6"><label class="w-100"><input type="radio" name="level" value="advanced" class="option-input"><div class="option-card"><h5>Mahir</h5><small>Sudah rutin</small></div></label></div>
                            </div>
                            <h6 class="text-start text-muted mb-3"><i class="fas fa-calendar-alt me-2"></i>Frekuensi Latihan</h6>
                            <div class="row g-3 mb-4">
                                <div class="col-4"><label class="w-100"><input type="radio" name="days" value="3" class="option-input" checked><div class="option-card"><h3>3</h3><small>Hari</small></div></label></div>
                                <div class="col-4"><label class="w-100"><input type="radio" name="days" value="4" class="option-input"><div class="option-card"><h3>4</h3><small>Hari</small></div></label></div>
                                <div class="col-4"><label class="w-100"><input type="radio" name="days" value="5" class="option-input"><div class="option-card"><h3>5</h3><small>Hari</small></div></label></div>
                            </div>
                            <button onclick="generatePlan()" class="btn btn-sky btn-lg px-5 rounded-pill shadow"><i class="fas fa-magic me-2"></i>Generate ke Workspace</button>
                            <p class="text-muted mt-3 small">Hasil akan ditransfer ke tab "Workspace" untuk Anda tinjau.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- DATA & SETUP ---
        const exercises = [
            { id: 1, name: "Bench Press", muscle: "Chest", img: "https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=150" },
            { id: 2, name: "Squat", muscle: "Legs", img: "https://images.unsplash.com/photo-1574680178050-55c6a6a96e0a?w=150" },
            { id: 3, name: "Deadlift", muscle: "Back", img: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=150" },
            { id: 4, name: "Pull Up", muscle: "Back", img: "https://media.gettyimages.com/id/2211604126/photo/unrecognizable-fit-woman-doing-resistance-band-assisted-pull-ups-in-gym.jpg?s=612x612&w=0&k=20&c=Jxd8U3JnLrBkIse8MaXmHz5SVaTJ3U944g14dyqN82c=" },
            { id: 5, name: "Overhead Press", muscle: "Shoulder", img: "https://images.unsplash.com/photo-1541534741688-6078c6bfb5c5?w=150" },
            { id: 6, name: "Dumbbell Curl", muscle: "Bicep", img: "https://images.unsplash.com/photo-1581009137042-c552e485697a?w=150" },
            { id: 7, name: "Tricep Pushdown", muscle: "Tricep", img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=1470&auto=format&fit=crop" }
        ];

        let currentExercise = null;
        const daysArr = ['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu', 'minggu'];

        // --- INIT SAAT LOAD ---
        window.onload = function() {
            initManual();
            loadSchedule();
        };


        // --- FUNGSI WORKOUT ---
        function initManual() {
            const list = document.getElementById('exerciseList');
            list.innerHTML = '';
            exercises.forEach(ex => {
                list.innerHTML += `
                    <div class="exercise-item" onclick="selectManualEx(${ex.id}, this)">
                        <img src="${ex.img}" class="exercise-thumb">
                        <div><strong>${ex.name}</strong><br><small>${ex.muscle}</small></div>
                    </div>`;
            });
        }
// ... (fungsi lainnya) ...

        function selectManualEx(id, el) {
            document.querySelectorAll('.exercise-item').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
            currentExercise = exercises.find(e => e.id === id);
            
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('configForm').style.display = 'block';
            document.getElementById('previewImg').src = currentExercise.img;
            document.getElementById('previewName').innerText = currentExercise.name;
            document.getElementById('previewMuscle').innerText = currentExercise.muscle;
        }

        function addToManualSchedule() {
            if(!currentExercise) return;
            const day = document.getElementById('inputDay').value;
            const sets = document.getElementById('inputSets').value;
            const reps = document.getElementById('inputReps').value;
            const target = document.getElementById(`day-${day}`);
            
            target.innerHTML += createWorkoutChip(currentExercise.name, sets, reps);
        }

        function generatePlan() {
            const level = document.querySelector('input[name="level"]:checked').value;
            const days = parseInt(document.querySelector('input[name="days"]:checked').value);
            
            let activeDays = [];
            if(days === 3) activeDays = [0, 2, 4]; 
            else if(days === 4) activeDays = [0, 1, 3, 4]; 
            else if(days === 5) activeDays = [0, 1, 2, 4, 5]; 

            daysArr.forEach((dayName, i) => {
                const target = document.getElementById(`day-${dayName}`);
                target.innerHTML = ''; 

                if(activeDays.includes(i)) {
                    let workoutType = "Full Body";
                    if(level === 'advanced' && days >= 4) workoutType = (i % 2 === 0) ? "Upper Body" : "Lower Body";
                    
                    target.innerHTML += `<div class="bg-dark text-white text-center p-1 mb-2 rounded sticky-top" style="font-size:0.7rem;">${workoutType}</div>`;

                    const count = 5;
                    const shuffled = exercises.sort(() => 0.5 - Math.random()).slice(0, count);
                    
                    shuffled.forEach(w => {
                        target.innerHTML += createWorkoutChip(w.name, 3, 12);
                    });
                } else {
                    target.innerHTML += `
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-bed fa-2x mb-2"></i><br>REST
                        </div>
                    `;
                }
            });

            const triggerEl = document.querySelector('#manual-tab');
            const tab = new bootstrap.Tab(triggerEl);
            tab.show();

            Swal.fire({
                icon: 'success',
                title: 'Jadwal Dibuat!',
                text: 'Silakan cek dan simpan jadwal Anda di tab Workspace.',
                timer: 2000,
                showConfirmButton: false
            });
        }

        function createWorkoutChip(name, sets, reps) {
            return `
                <div class="workout-chip">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong style="font-size:0.8em">${name}</strong>
                        <i class="fas fa-times text-danger" style="cursor:pointer; font-size:0.7rem;" onclick="this.parentElement.parentElement.remove()"></i>
                    </div>
                    <div style="font-size:0.75rem">${sets} Sets x ${reps} Reps</div>
                </div>
            `;
        }

        function saveSchedule() {
            const scheduleData = {};
            daysArr.forEach(day => {
                const content = document.getElementById(`day-${day}`).innerHTML;
                scheduleData[day] = content;
            });
            localStorage.setItem('myGymPlan', JSON.stringify(scheduleData));
            Swal.fire({
                title: 'Tersimpan!',
                text: 'Jadwal latihan Anda aman di browser ini.',
                icon: 'success',
                confirmButtonColor: '#00bfa6'
            });
        }

        function loadSchedule() {
            const savedData = localStorage.getItem('myGymPlan');
            if (savedData) {
                const scheduleData = JSON.parse(savedData);
                daysArr.forEach(day => {
                    if(scheduleData[day]) {
                        document.getElementById(`day-${day}`).innerHTML = scheduleData[day];
                    }
                });
            }
        }

        function clearSchedule() {
            Swal.fire({
                title: 'Hapus Jadwal?',
                text: "Semua latihan di tabel akan dihapus permanen.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#00bfa6',
                confirmButtonText: 'Ya, Reset!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    daysArr.forEach(day => {
                        document.getElementById(`day-${day}`).innerHTML = '';
                    });
                    localStorage.removeItem('myGymPlan');
                    Swal.fire('Terhapus!', 'Jadwal kembali kosong.', 'success');
                }
            })
        }
    </script>
</body>
</html>